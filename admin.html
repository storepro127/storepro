<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | Tech Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap'); body { font-family: 'Cairo', sans-serif; }</style>
</head>
<body class="bg-gray-100">

<div id="login-box" class="max-w-md mx-auto mt-20 p-8 bg-white rounded-2xl shadow-xl text-center">
    <h2 class="text-2xl font-black mb-6">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
    <input type="password" id="pass" placeholder="Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ (11211)" class="w-full border-2 p-3 rounded-xl mb-4 text-center">
    <button onclick="login()" class="w-full bg-black text-white py-4 rounded-xl font-bold">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="admin-ui" class="hidden">
    <nav class="bg-slate-900 p-4 sticky top-0 z-50 overflow-x-auto">
        <div class="container mx-auto flex gap-2 justify-center min-w-max">
            <button onclick="showSection('products')" class="bg-white text-black px-4 py-2 rounded-lg font-bold text-sm"><i class="fa fa-box"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
            <button onclick="showSection('add')" class="bg-yellow-500 text-black px-4 py-2 rounded-lg font-bold text-sm"><i class="fa fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
            <button onclick="showSection('orders')" class="bg-blue-500 text-white px-4 py-2 rounded-lg font-bold text-sm"><i class="fa fa-shopping-bag"></i> Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
            <button onclick="showSection('coupons')" class="bg-purple-500 text-white px-4 py-2 rounded-lg font-bold text-sm"><i class="fa fa-tag"></i> Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø®ØµÙ…</button>
            <a href="index.html" class="bg-green-500 text-white px-4 py-2 rounded-lg font-bold text-sm"><i class="fa fa-eye"></i> Ø§Ù„Ù…ØªØ¬Ø±</a>
        </div>
    </nav>

    <main class="container mx-auto p-4 lg:p-8">
        <section id="add-sec" class="hidden max-w-lg mx-auto bg-white p-6 rounded-2xl shadow-md">
            <h2 class="text-xl font-black mb-6 border-b pb-2">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>
            <form onsubmit="saveProduct(event)" class="space-y-4">
                <input required id="p-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" class="w-full border p-3 rounded-xl">
                <input required id="p-price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" class="w-full border p-3 rounded-xl">
                <input required id="p-stock" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©" class="w-full border p-3 rounded-xl">
                <div class="border-2 border-dashed p-4 rounded-xl text-center">
                    <input type="file" id="p-img" accept="image/*" class="w-full text-xs">
                </div>
                <button id="add-btn" class="w-full bg-yellow-500 py-4 rounded-xl font-black">Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø¢Ù†</button>
            </form>
        </section>

        <section id="orders-sec" class="hidden">
            <h2 class="text-2xl font-black mb-6">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø²Ø¨Ø§Ø¦Ù† ğŸ“¦</h2>
            <div id="orders-list" class="space-y-4"></div>
        </section>

        <section id="products-sec" class="hidden">
            <h2 class="text-2xl font-black mb-6">ØªØ¹Ø¯ÙŠÙ„ ÙˆÙ…Ø³Ø­ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
            <div id="products-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
        </section>

        <section id="coupons-sec" class="hidden max-w-md mx-auto bg-white p-6 rounded-2xl shadow-md">
            <h2 class="text-xl font-black mb-6">Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø®ØµÙ…</h2>
            <div class="space-y-4">
                <input id="c-code" placeholder="Ø§Ù„ÙƒÙˆØ¯ (Ù…Ø«Ù„Ø§Ù‹: EGYPT)" class="w-full border p-3 rounded-xl">
                <input id="c-perc" type="number" placeholder="Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… %" class="w-full border p-3 rounded-xl">
                <button onclick="addCoupon()" class="w-full bg-purple-600 text-white py-3 rounded-xl font-bold">Ø­ÙØ¸ Ø§Ù„ÙƒÙˆØ¯</button>
            </div>
            <div id="coupons-display" class="mt-6 space-y-2"></div>
        </section>
    </main>
</div>

<script>
    const DB_URL = "https://tech-store-71bce-default-rtdb.firebaseio.com/"; //
    let currentImg = "";

    function login() {
        if(document.getElementById('pass').value === "11211") {
            document.getElementById('login-box').classList.add('hidden');
            document.getElementById('admin-ui').classList.remove('hidden');
            showSection('products');
        } else alert('Ø§Ù„Ø±Ù…Ø² ØºÙ„Ø·!');
    }

    function showSection(sec) {
        document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
        if(sec === 'products') { document.getElementById('products-sec').classList.remove('hidden'); loadProducts(); }
        if(sec === 'add') document.getElementById('add-sec').classList.remove('hidden');
        if(sec === 'orders') { document.getElementById('orders-sec').classList.remove('hidden'); loadOrders(); }
        if(sec === 'coupons') { document.getElementById('coupons-sec').classList.remove('hidden'); loadCoupons(); }
    }

    document.getElementById('p-img').onchange = (e) => {
        const reader = new FileReader();
        reader.onload = () => currentImg = reader.result;
        reader.readAsDataURL(e.target.files[0]);
    };

    async function saveProduct(e) {
        e.preventDefault();
        const btn = document.getElementById('add-btn'); btn.disabled = true;
        const p = {
            name: document.getElementById('p-name').value,
            price: parseFloat(document.getElementById('p-price').value),
            stock: parseInt(document.getElementById('p-stock').value),
            img: currentImg
        };
        await fetch(DB_URL + "products.json", { method: 'POST', body: JSON.stringify(p) });
        alert('ØªÙ… Ø§Ù„Ø­ÙØ¸!'); location.reload();
    }

    async function loadProducts() {
        const res = await fetch(DB_URL + "products.json");
        const data = await res.json();
        const list = document.getElementById('products-list');
        list.innerHTML = "";
        Object.keys(data || {}).forEach(key => {
            const p = data[key];
            list.innerHTML += `
                <div class="bg-white p-4 rounded-xl shadow-sm flex gap-4">
                    <img src="${p.img}" class="w-20 h-20 rounded object-cover">
                    <div class="flex-1">
                        <b>${p.name}</b><br>
                        <span class="text-sm">Ø§Ù„Ø³Ø¹Ø±: ${p.price} | ÙƒÙ…ÙŠØ©: ${p.stock}</span>
                        <div class="mt-2 flex gap-2">
                            <button onclick="deleteItem('products/${key}')" class="text-red-500 text-xs font-bold">Ø­Ø°Ù</button>
                            <button onclick="updateStock('${key}', ${p.stock})" class="text-blue-500 text-xs font-bold">ØªØ¹Ø¯ÙŠÙ„ ÙƒÙ…ÙŠØ©</button>
                        </div>
                    </div>
                </div>`;
        });
    }

    async function loadOrders() {
        const res = await fetch(DB_URL + "orders.json");
        const data = await res.json();
        const list = document.getElementById('orders-list');
        list.innerHTML = Object.keys(data || {}).reverse().map(key => {
            const o = data[key];
            return `
                <div class="bg-white p-6 rounded-2xl shadow-md border-r-8 border-blue-500">
                    <div class="flex justify-between mb-4">
                        <h4 class="font-black text-lg">${o.customer}</h4>
                        <span class="text-blue-600 font-bold">${o.total} Ø¬.Ù…</span>
                    </div>
                    <p class="text-sm mb-2 text-gray-600"><b>Ù…ÙˆØ¨Ø§ÙŠÙ„:</b> ${o.phone}</p>
                    <p class="text-sm mb-4 text-gray-600"><b>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</b> ${o.fullAddress}</p>
                    <div class="flex gap-2 overflow-x-auto pb-4">
                        ${o.items.map(i => `<img src="${i.img}" title="${i.name}" class="w-12 h-12 rounded border shadow-sm">`).join('')}
                    </div>
                    <button onclick="deleteItem('orders/${key}')" class="bg-red-100 text-red-600 w-full py-2 rounded-lg font-bold">Ù…Ø³Ø­ Ø§Ù„Ø·Ù„Ø¨</button>
                </div>`;
        }).join('');
    }

    async function addCoupon() {
        const c = { code: document.getElementById('c-code').value.toUpperCase(), perc: parseInt(document.getElementById('c-perc').value) };
        await fetch(DB_URL + "coupons.json", { method: 'POST', body: JSON.stringify(c) });
        loadCoupons();
    }

    async function loadCoupons() {
        const res = await fetch(DB_URL + "coupons.json");
        const data = await res.json();
        document.getElementById('coupons-display').innerHTML = Object.keys(data || {}).map(key => `
            <div class="flex justify-between bg-gray-50 p-2 rounded">${data[key].code} (${data[key].perc}%) <button onclick="deleteItem('coupons/${key}')" class="text-red-500 text-xs">Ø­Ø°Ù</button></div>
        `).join('');
    }

    async function deleteItem(path) { if(confirm('Ù…ØªØ£ÙƒØ¯ØŸ')) { await fetch(DB_URL + path + ".json", { method: 'DELETE' }); location.reload(); } }
    
    async function updateStock(key, current) {
        const n = prompt("Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:", current);
        if(n) await fetch(DB_URL + `products/${key}/stock.json`, { method: 'PUT', body: n });
        loadProducts();
    }
</script>
</body>
</html>
